django-webpack
==============

[![Build Status](https://travis-ci.org/markfinger/django-webpack.svg?branch=master)](https://travis-ci.org/markfinger/django-webpack)

Generates JS bundles from Django by calling webpack on your [config files](webpack.github.io/docs/configuration.html) and providing helpers to integrate the bundles into your frontend.

```python
from django_webpack import WebpackBundle

webpack_bundle = WebpackBundle('path/to/webpack.config.js')

urls = webpack_bundle.get_urls()
```

You can pass a WebpackBundle into a template and render script elements pointing to the bundle.
```html
{{ webpack_bundle.render }}
```

A helper is provided for [configuring your bundle](webpack.github.io/docs/configuration.html), the substring `{{ BUNDLE_ROOT }}` will be replaced with the [BUNDLE_ROOT](#django_webpackbundle_root) path.

```javascript
var path = require('path');

module.exports = {
  // ...
  output: {
    // The token `{{ BUNDLE_ROOT }}` will be replaced with the
    // DJANGO_WEBPACK['BUNDLE_ROOT'] setting
    path: '{{ BUNDLE_ROOT }}',
    // ..
  }
};
```

If you provide a relative path to a config file to a WebpackBundle, django-webpack will attempt to use django's static file finders to resolve the file's location. For example, `WebpackBundle('my_app/webpack.config.js')` could match a file within an app's static directory - eg: `<app>/static/my_app/webpack.config.js`.

Documentation
-------------

- [Installation](#installation)
- [Recommended configuration](#recommended-configuration)
- [Settings](#settings)
  - [BUNDLE_ROOT](#django_webpackbundle_root)
  - [BUNDLE_URL](#django_webpackbundle_url)
  - [CACHE](#django_webpackcache)
- [Running the tests](#running-the-tests)


Installation
------------

**Please note** that django-webpack is a work in progress. At this point, you will likely need to `pip install` both django-webpack and django-node from their respective `master` branches. The PyPI versions of both are out of date and are unlikely to be updated shortly due to their transitioning APIs.

```bash
pip install -e git+ssh://git@github.com/markfinger/django-node.git#egg=django-node
pip install -e git+ssh://git@github.com/markfinger/django-webpack.git#egg=django-webpack
```

If you wish, you can install a more stable version of django-webpack, however be aware that the performance will be significantly slower and the configuration API is completely different. Check this repository's tags for the respective version's documentation.

```bash
pip install django-webpack
```

You will also need to configure [django-node](https://github.com/markfinger/django-node) to provide django-webpack's service.

```python
# in settings.py

DJANGO_NODE = {
    'SERVICES': (
        'django_webpack.services',
    ),
}
```

Recommended configuration
-------------------------

The following setup provides a basic configuration to enable django-webpack in both development and production.

```python
# in settings.py

import os

DEBUG = True

# Configure your django project's static and media handling
BASE_DIR = os.path.dirname(os.path.dirname(__file__))
STATIC_ROOT = os.path.join(BASE_DIR, 'static')
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
STATIC_URL = '/static/'
MEDIA_URL = '/media/'

# Inform django-node to provide django-webpack's services
DJANGO_NODE = {
    'SERVICES': (
        'django_webpack.services',
    ),
}

if DEBUG:
    # During development, you have to circumvent some of the devserver's 
    # limitations with handling static files, so we rely on the MEDIA_ROOT 
    # and MEDIA_URL settings.
    DJANGO_WEBPACK = {
        'BUNDLE_ROOT': os.path.join(MEDIA_ROOT, 'bundles'),
        'BUNDLE_URL': MEDIA_URL + 'bundles/',
    }
else:
    # In production, you should rely on your static file server to serve
    # from the STATIC_ROOT and STATIC_URL
    DJANGO_WEBPACK = {
        'BUNDLE_ROOT': os.path.join(STATIC_ROOT, 'bundles'),
        'BUNDLE_URL': STATIC_URL + 'bundles/',
    }
```

```python
# in urls.py

from django.conf.urls import patterns
from django.conf import settings
from django.conf.urls.static import static


urlpatterns = patterns('',
   # ...
)

if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```


Settings
--------

### DJANGO_WEBPACK['BUNDLE_ROOT']

An absolute path to the directory which django-webpack will try to infer urls from.

**This setting must be defined**

### DJANGO_WEBPACK['BUNDLE_URL']

The url which is prepended to the paths of bundles relative to the BUNDLE_ROOT.

**This setting must be defined**

### DJANGO_WEBPACK['CACHE']

If `True`, Django Webpack will maintain an in-memory cache of the output generated by
Webpack and return paths to previously-generated bundles.

Using the cache will massively improve the speed of re-rendering bundles, but is only
recommended for use in production environments.

Default:
```python
not django.conf.settings.DEBUG
```


Running the tests
-----------------

```bash
mkvirtualenv django-webpack
pip install -r requirements.txt
python runtests.py
```
