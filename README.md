django-webpack
==============

[![Build Status](https://travis-ci.org/markfinger/django-webpack.svg?branch=master)](https://travis-ci.org/markfinger/django-webpack)

Generate JS bundles from Django.
```python
from django_webpack import WebpackBundle

bundle = WebpackBundle('path/to/webpack.config.js')

urls = bundle.get_urls()
```

You can also pass the bundle into a template and render script elements pointing to your bundle.
```html
{{ bundle.render }}
```

django-webpack provides a `{{ BUNDLE_ROOT }}` helper that you can use when defining your [webpack config's](webpack.github.io/docs/configuration.html) output path.

```javascript
var path = require('path');

module.exports = {
  context: path.join(__dirname, 'app'),
  entry: './entry.js',
  output: {
    // The token `{{ BUNDLE_ROOT }}` will be replaced with the
    // DJANGO_WEBPACK['BUNDLE_ROOT'] setting
    path: '{{ BUNDLE_ROOT }}',
    filename: 'bundle-[hash].js'
  }
};
```

Documentation
-------------

- [Installation](#installation)
- [Recommended configuration](#recommended-configuration)
- [Settings](#settings)
  - [BUNDLE_ROOT](#django_webpackbundle_root)
  - [BUNDLE_URL](#django_webpackbundle_url)
  - [CACHE](#django_webpackcache)
- [Running the tests](#running-the-tests)


Installation
------------

**Please note** that django-webpack is a work in progress. At this point, you will likely need to `pip install` both django-webpack and django-node from their respective `master` branches. The PyPI versions of both are out of date and are unlikely to be updated shortly due to their fluctating APIs.

```bash
pip install -e git+ssh://git@github.com/markfinger/django-node.git#egg=django-node
pip install -e git+ssh://git@github.com/markfinger/django-webpack.git#egg=django-webpack
```

If you wish, you can install a more stable version of django-webpack, however be aware that the performance will be significantly slower and the configuration API is completely different. Check this repository's tags for the respective version's documentation.

```bash
pip install django-webpack
```

Recommended configuration
-------------------------

The following setup provides a basic configuration to enable django-webpack in both development and production.

```python
# in settings.py

import os

# Configure your django project's static and media handling
BASE_DIR = os.path.dirname(os.path.dirname(__file__))
STATIC_ROOT = os.path.join(BASE_DIR, 'static')
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
STATIC_URL = '/static/'
MEDIA_URL = '/media/'

if DEBUG:
    # During development, we have to circumvent some of the devserver's 
    # limitations, so we use the MEDIA_ROOT and MEDIA_URL
    DJANGO_WEBPACK = {
        'BUNDLE_ROOT': os.path.join(MEDIA_ROOT, 'bundles'),
        'BUNDLE_URL': MEDIA_URL + 'bundles/',
    }
else:
    # In production, you can rely on your static file server to serve
    # from the STATIC_ROOT and STATIC_URL
    DJANGO_WEBPACK = {
        'BUNDLE_ROOT': os.path.join(STATIC_ROOT, 'bundles'),
        'BUNDLE_URL': STATIC_URL + 'bundles/',
    }
```

```python
# in urls.py

from django.conf.urls import patterns
from django.conf import settings
from django.conf.urls.static import static


urlpatterns = patterns('',
   # ...
)

if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```


Settings
--------

### DJANGO_WEBPACK['BUNDLE_ROOT']

An absolute path to the directory which django-webpack will try to infer urls from.

**This setting must be defined**

### DJANGO_WEBPACK['BUNDLE_URL']

The url which is prepended to the paths of bundles relative to the BUNDLE_ROOT.

**This setting must be defined**

### DJANGO_WEBPACK['CACHE']

If `True`, Django Webpack will maintain an in-memory cache of the output generated by
Webpack and return paths to previously-generated bundles.

Using the cache will massively improve the speed of rendering bundles, but is only
recommended for use in production environments.

Default:
```python
not django.conf.settings.DEBUG
```


Running the tests
-----------------

```bash
mkvirtualenv django-webpack
pip install -r requirements.txt
python runtests.py
```
