django-webpack
==============

[![Build Status](https://travis-ci.org/markfinger/django-webpack.svg?branch=master)](https://travis-ci.org/markfinger/django-webpack)

Generate JS bundles from Django.
```python
from django_webpack import WebpackBundle

bundle = WebpackBundle('path/to/webpack.config.js')

urls = bundle.get_urls()
```

You can also pass a `WebpackBundle` into a template and render
a script element pointing to the generated bundle
```html
{{ bundle.render }}
```

When defining your webpack config file, place `{{ BUNDLE_ROOT }}` within your config's `output.path` property to have it replaced with the `DJANGO_WEBPACK['BUNDLE_ROOT']` setting.

```javascript
var path = require('path');

module.exports = {
  context: path.join(__dirname, 'app'),
	entry: './entry.js',
  output: {
    path: '{{ BUNDLE_ROOT }}',
    filename: 'bundle-[hash].js'
  }
};
```

Documentation
-------------

- [Installation](#installation)
- [Settings](#settings)
  - [BUNDLE_ROOT](#django_webpackbundle_root)
  - [BUNDLE_URL](#django_webpackbundle_url)
  - [CACHE](#django_webpackcache)
- [Running the tests](#running-the-tests)


Installation
------------

*Please note* that django-webpack is a work in progress. At this point, you will likely need to `pip install` both django-webpack and django-node from their respective `master` branches. The PyPI versions of both are out of date and are unlikely to be updated shortly due to their fluctating APIs.

```bash
-e git+ssh://git@github.com/markfinger/django-node.git#egg=django-node
-e git+ssh://git@github.com/markfinger/django-webpack.git#egg=django-webpack
```

If you wish, you can install a more stable version of django-webpack, however be aware that the performance will be significantly slower and the configuration API is completely different.

```bash
pip install django-webpack
```

Settings
--------

Settings can be overridden by defining a dictionary named `DJANGO_WEBPACK` in your settings file.

The following settings will enable you to use django-webpack in both development
and production.

```python
import os

# Django static/media settings
BASE_DIR = os.path.dirname(os.path.dirname(__file__))
STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'static')
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
MEDIA_URL = '/media/'

# django-webpack settings
if DEBUG:
    DJANGO_WEBPACK = {
        'BUNDLE_ROOT': os.path.join(MEDIA_ROOT, 'bundles'),
        'BUNDLE_URL': MEDIA_URL + 'bundles/',
    }
else:
    STATIC_ROOT = os.path.join(BASE_DIR, 'static')
    DJANGO_WEBPACK = {
        'BUNDLE_ROOT': os.path.join(STATIC_ROOT, 'bundles'),
        'BUNDLE_URL': STATIC_URL + 'bundles/',
    }
```

### DJANGO_WEBPACK['BUNDLE_ROOT']

An absolute path to the directory which django-webpack will try to infer urls from.

**This setting must be defined**

### DJANGO_WEBPACK['BUNDLE_URL']

The url which is prepended to the paths of bundles relative to the BUNDLE_ROOT.

**This setting must be defined**

### DJANGO_WEBPACK['CACHE']

If `True`, Django Webpack will maintain an in-memory cache of the output generated by
Webpack and return paths to previously-generated bundles.

Using the cache will massively improve the speed of rendering bundles, but is only
recommended for use in production environments.

Default:
```python
not django.conf.settings.DEBUG
```


Running the tests
-----------------

```bash
mkvirtualenv django-webpack
pip install -r requirements.txt
python runtests.py
```
